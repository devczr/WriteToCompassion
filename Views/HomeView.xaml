<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:skia="clr-namespace:SkiaSharp.Extended.UI.Controls;assembly=SkiaSharp.Extended.UI"
    xmlns:triggers="clr-namespace:WriteToCompassion.Triggers"
    xmlns:viewmodels="clr-namespace:WriteToCompassion.ViewModels"
    xmlns:models="clr-namespace:WriteToCompassion.Models"
    xmlns:mct="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
    xmlns:helpers="clr-namespace:WriteToCompassion.Helpers"
    xmlns:controls="clr-namespace:WriteToCompassion.Controls"
    x:DataType="viewmodels:HomeViewModel"
    x:Class="WriteToCompassion.Views.HomeView"
    Shell.TabBarIsVisible="True"
    Title="Home">

    <Shell.BackButtonBehavior>
        <BackButtonBehavior IsEnabled="False"
                            IsVisible="False"/>
    </Shell.BackButtonBehavior>
    <Shell.TitleView>
        <Grid
            HeightRequest="50"
            Padding="5"
            ColumnDefinitions="5*,*">
            <Label 
                Text="Home" 
                Grid.Column="0"
                VerticalOptions="Center"
                FontSize="Title"
                FontAttributes="Bold"
                TextColor="White"/>
            <ImageButton 
                Source="settingsicon.png"
                Grid.Column="1"
                Scale="0.5"
                Command="{Binding GoToSettingsCommand}"/>
        </Grid>
    </Shell.TitleView>

    <ContentPage.Behaviors>
        <mct:EventToCommandBehavior EventName="NavigatedTo" Command="{Binding GetAllThoughtsCommand}" />
    </ContentPage.Behaviors>

    <Grid x:Name="primaryGrid"
        BackgroundColor="Transparent"
        InputTransparent="False"
        RowDefinitions="*,3*"
        Padding="15">

        <Border
            x:Name="contentBorder"
            Grid.Row="0"
            BackgroundColor="Transparent"
            ZIndex="4">
            <Label
                x:Name="dropLabel"
                IsVisible="True"
                Text="no"
                VerticalOptions="Center"
                HorizontalOptions="Center"
                FontSize="Large"
                FontAttributes="Bold"
                TextColor="HotPink"
                ZIndex="5">

            </Label>
            <Border.GestureRecognizers>
            </Border.GestureRecognizers>
        </Border>

        <!--Custom Cloud Controls-->
        <!--Height and Width set according to SVG pixel dimensions-->
        <!--TapGestureRecognizer inside CustomCloudControl xaml-->
        <Grid
            x:Name="cloudGrid"
            Grid.Row="1"
            BindableLayout.ItemsSource="{Binding Clouds}">
            <BindableLayout.ItemTemplate>
                <DataTemplate x:DataType="models:Cloud">
                    <controls:CustomCloudControl
                        IsVisible="true"
                        HorizontalOptions="Center"
                        VerticalOptions="End"
                        WidthRequest="200"
                        HeightRequest="126"
                        ZIndex="2"
                        CloudControlID="{Binding CloudID}"
                        CloudAnimation="{Binding AnimationType}"
                        Scale="{Binding Source={x:RelativeSource AncestorType={x:Type viewmodels:HomeViewModel}}, Path=CloudScale}">
                    </controls:CustomCloudControl>
                </DataTemplate>
            </BindableLayout.ItemTemplate>
        </Grid>

        <skia:SKLottieView  x:Name="cloudlottie"
                            Grid.Row="1"
                            VerticalOptions="EndAndExpand"
                            HorizontalOptions="Center"
                            WidthRequest="600"
                            HeightRequest="140"
                            Opacity="1"
                            IsAnimationEnabled="false"
                            IsVisible="False"
                            ZIndex="0"
                            RepeatCount="-1"
                            Source="bigcloudlottie.json"/>
        <HorizontalStackLayout
            VerticalOptions="End"
            Grid.Row="1">
            <Label
                Margin="10"
                HorizontalTextAlignment="End"
                x:Name="sizeLabel"
                Text="initial"
                FontSize="Micro"
                TextColor="DarkOrange"/>
            <Button
                HorizontalOptions="End"
                x:Name="sizeButton"
                FontAutoScalingEnabled="True"
                Text="measure"
                FontSize="Micro"
                TextColor="OrangeRed"
                Clicked="OnMeasureClicked"/>
            <Button
                HorizontalOptions="End"
                x:Name="prop"
                FontAutoScalingEnabled="True"
                Text="propchange"
                FontSize="Micro"
                TextColor="YellowGreen"
                Command="{Binding PopulateCloudsCommand}"/>
            <Button
                HorizontalOptions="End"
                x:Name="workButton"
                FontAutoScalingEnabled="True"
                Text="$"
                FontSize="Micro"
                TextColor="IndianRed"
                Command="{Binding TestCloudsPropertiesCommand}"/>
        </HorizontalStackLayout>


    </Grid>
</ContentPage>